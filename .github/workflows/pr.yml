name: ğŸ¤– AkÄ±llÄ± M3U8 GÃ¼ncelleyici

on:
  schedule:
    - cron: "0 */6 * * *"  # Her 6 saatte bir
  workflow_dispatch:

jobs:
  check-and-pr:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ›ï¸ Repoyu Ã‡ek
      uses: actions/checkout@v4

    - name: ğŸ Python Kur
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: ğŸ“¦ BaÄŸÄ±mlÄ±lÄ±klarÄ± Kur
      run: pip install cloudscraper requests Kekik

    - name: ğŸ”„ GÃ¼ncellemeleri Kontrol Et ve PR AÃ§
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # Scripti Ã§alÄ±ÅŸtÄ±r ve deÄŸiÅŸiklik kontrolÃ¼ yap
        python m3u8_updater.py
        DEGISIKLIK=$(python -c "import json; print(json.load(open('$GITHUB_OUTPUT'))['degisiklik'])")

        if [ "$DEGISIKLIK" = "true" ]; then
          # Yeni branch oluÅŸtur
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git checkout -b "m3u8-guncelleme-$(date +'%Y%m%d-%H%M%S')"
          
          # DeÄŸiÅŸiklikleri kaydet
          git add channels.m3u
          git commit -m "ğŸ¤– Otomatik GÃ¼ncelleme: $(date +'%d.%m.%Y %H:%M')"
          
          # PR oluÅŸtur
          git push origin HEAD
          gh pr create --base main --head "$(git branch --show-current)" \
            --title "ğŸ¤– M3U8 GÃ¼ncellemesi" \
            --body "Otomatik olarak oluÅŸturuldu"
        else
          echo "DeÄŸiÅŸiklik yok, iÅŸlem yapÄ±lmadÄ±"
        fi
